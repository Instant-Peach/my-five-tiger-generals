# 에픽 2 회고: 장수 시스템 (General System)

**프로젝트:** 오호대장군 (Five Tiger Generals)
**에픽:** Epic 2 - 장수 시스템
**회고 날짜:** 2026-02-04
**진행자:** Bob (Scrum Master)

---

## 에픽 요약

### 전달 지표

| 항목 | 값 |
|------|-----|
| 완료된 스토리 | 5/5 (100%) |
| 테스트 증가 | 191 → 261개 (+70개) |
| 신규 파일 | 15개+ |
| 수정 파일 | 20개+ |
| 차단 요소 | 0개 |
| 기술 부채 | 4개 항목 |

### 완료된 스토리

| # | 스토리 | 상태 | 주요 성과 |
|---|--------|------|----------|
| 2-1 | 장수 배치 | done | General 타입, 팩토리 함수, 초기 상태, GeneralRenderer |
| 2-2 | 장수 선택 | done | selectGeneral 액션, Result<T> 패턴, 하이라이트, 코드 리뷰 10개 이슈 수정 |
| 2-3 | 스탯 표시 | done | React GeneralStatsPanel, Zustand 스토어, Phaser-React 이벤트 통합 |
| 2-4 | 플레이어 색상 | done | PLAYER_COLORS, 색맹 지원 (이모지 아이콘), WCAG 2.1 대비율 자동화 테스트 |
| 2-5 | 병력 표시 | done | TroopIndicator, TroopBar, 병력 상태 로직, 변화 애니메이션 |

---

## 팀 참석자

| 이름 | 역할 |
|------|------|
| Bob (Max) | Scrum Master (진행자) |
| Alice (Samus Shepard) | Product Owner / Game Designer |
| Charlie (Cloud Dragonborn) | Senior Dev / Game Architect |
| Dana (GLaDOS) | QA Engineer |
| Elena (Indie) | Junior Dev |
| CHOI | Project Lead |

---

## 성공 및 강점

### 1. 아키텍처 경계 100% 준수
- game-core: Phaser 의존성 없이 순수 TypeScript 로직 유지 (5/5 스토리)
- game-renderer: 렌더링 전용 로직 분리
- apps/web: React UI 분리
- Phase 2 Colyseus 서버 재사용 기반 확실히 마련

### 2. 점진적 테스트 확장
- Epic 시작: 191개 → Epic 완료: 261개 (+70개 테스트)
- 각 스토리가 이전 테스트 기반 위에 구축
- WCAG 색상 대비율 자동화 테스트 도입 (Story 2-4)

### 3. 코드 리뷰 문화 정착
- Story 2-2 코드 리뷰에서 10개 이슈 발견 및 수정
  - 3 High, 4 Medium, 3 Low
  - 6개 즉시 수정, 1개 Epic 8로 이연
- 품질 향상에 직접적 기여

### 4. Event Bus 패턴 안정화
- `general:selected`, `general:deselected` 이벤트 검증 완료
- `general:troops-changed` 이벤트 정의 (Epic 4에서 활용 예정)
- Phaser ↔ React 통신 패턴 확립

### 5. 접근성 우선 문화
- 색맹 지원: 아이콘 + 색상 조합 (🛡️/⚔️, ✓/⚠️/❗/❌)
- WCAG 2.1 대비율 자동화 테스트 (color-contrast.test.ts)
- aria 속성 적용 (progressbar, label 등)

### 6. 타입 안전 에러 처리
- Result<T> 패턴 도입 (Story 2-2)
- GameErrorCode union type 정의
- 컴파일 타임에 에러 케이스 강제 처리

---

## 도전 및 성장 영역

### 1. React Hooks 복잡성
- **문제:** Story 2-3에서 useEffect 무한 루프 발생
- **원인:** prevTroops를 useState로 관리하면서 dependency 문제
- **해결:** useState → useRef로 변경, timer 클린업 개선
- **학습:** React 훅의 dependency 관리 주의 필요

### 2. TailwindCSS v4 + React Portal 이슈
- **문제:** createPortal로 document.body에 렌더링 시 일부 Tailwind 클래스 미적용
- **증상:** `fixed`, `bg-gray-800` 등 핵심 클래스 동작 안 함
- **해결:** 핵심 레이아웃 속성은 inline style로 우회
- **학습:** TailwindCSS 설정 점검 필요 (@source 경로, PostCSS)

### 3. E2E 테스트 부재
- **문제:** Epic 1에서 약속한 E2E 프레임워크 도입 미완료
- **영향:** 회귀 테스트 커버리지 부족, 수동 테스트 의존
- **계획:** Epic 3 완료 전 Playwright 도입 필수

### 4. 에러 메시지 UI 부재
- **문제:** 에러가 콘솔에만 출력되고 사용자에게 표시 안 됨
- **영향:** UX 저하, 사용자 피드백 부족
- **계획:** Epic 8 UI/UX에서 처리

---

## 핵심 인사이트

1. **아키텍처 경계 준수가 장기적 가치 창출** - game-core 분리로 서버 재사용 기반 확보
2. **코드 리뷰가 품질을 높인다** - Story 2-2에서 10개 이슈 사전 발견
3. **접근성은 선택이 아닌 필수** - 색맹 지원, WCAG 테스트 자동화가 표준이 됨
4. **점진적 테스트 확장** - 매 스토리마다 테스트 증가로 리팩토링 자신감 확보
5. **TDD 효과** - RED-GREEN-REFACTOR 사이클이 설계 품질 향상

---

## 기술 부채

| # | 항목 | 우선순위 | 출처 | 비고 |
|---|------|---------|------|------|
| 1 | Playwright E2E 테스트 미작성 | MEDIUM | Story 2-3, 2-4 | Epic 3 완료 전 도입 |
| 2 | 병력 변화 애니메이션 실제 검증 | LOW | Story 2-3 | Epic 4 전투 시스템에서 자동 검증 |
| 3 | TailwindCSS Portal 이슈 근본 해결 | LOW | Story 2-4 | 현재 inline style로 우회 중 |
| 4 | 에러 메시지 UI | MEDIUM | Story 2-2 | Epic 8 UI/UX에서 처리 |

---

## 액션 아이템

### 프로세스 개선

| # | 액션 아이템 | 담당 | 마감 | 성공 기준 |
|---|------------|------|------|----------|
| 1 | E2E 테스트 프레임워크 도입 (Playwright) | Dana (QA) | Epic 3 완료 전 | 최소 1개 E2E 테스트 작성 |
| 2 | TailwindCSS Portal 이슈 조사 | Elena (Dev) | Epic 3 중 | 근본 원인 파악 및 해결책 문서화 |

### 팀 합의 (계속 유지)

- [x] game-core에 Phaser 의존성 절대 금지 (계속 준수)
- [x] 새 상수/타입은 game-core에 먼저 정의
- [x] 스토리 완료 시 Dev Notes에 학습 내용 기록
- [x] 코드 리뷰에서 아키텍처 경계 확인
- [x] 접근성 (색맹 지원, WCAG 대비율) 필수 검증

---

## Epic 1 회고 액션 아이템 추적

| # | 액션 아이템 | 담당 | 상태 | 비고 |
|---|------------|------|------|------|
| 1 | E2E 테스트 프레임워크 조사 | Dana (QA) | ⏳ 진행 중 | Playwright 언급 있으나 실제 도입 미완료 |
| 2 | Phaser API 참고 문서 정리 | Charlie (Dev) | ✅ 완료 | Dev Notes에 API 패턴 기록 |

**Epic 1 팀 합의 준수 여부:**
- ✅ game-core Phaser 금지: 완전 준수 (5/5 스토리)
- ✅ 상수/타입 game-core 정의: 준수 (PLAYER_COLORS, TROOP_COLORS)
- ✅ Dev Notes 기록: 준수 (5개 스토리 모두)
- ✅ 코드 리뷰 아키텍처 확인: 준수 (Story 2-2 코드 리뷰)

---

## Epic 3 준비 태스크

### 의존성 확인

| 의존성 | 상태 | 비고 |
|--------|------|------|
| General 타입 및 speed 스탯 | ✅ 완료 | Story 2-1 |
| 장수 선택 시스템 | ✅ 완료 | Story 2-2 |
| 장수 위치 정보 (position) | ✅ 완료 | Story 2-1 |
| getGeneralAtTile() 함수 | ✅ 완료 | Story 2-1 |
| 타일 좌표 시스템 (인접 타일) | ✅ 완료 | Epic 1 Story 1-6 |

**결론:** Epic 3 시작을 위한 모든 의존성 충족됨. 특별한 준비 작업 없이 즉시 시작 가능.

---

## 중요 발견 사항

**에픽 업데이트 필요:** 아니오

Epic 2에서 Epic 3 계획을 근본적으로 변경해야 할 발견은 없었습니다.
- 장수 시스템 정상 작동
- speed 스탯으로 이동 범위 계산 가능
- 선택 시스템 확장 가능

---

## 준비 상태 평가

| 항목 | 상태 | 비고 |
|------|------|------|
| 테스트 & 품질 | ✅ 완료 | 261개 단위 테스트 통과 |
| 배포 | ✅ 완료 | 빌드 성공, dev 서버 실행 확인 |
| 기술 건강 | ✅ 양호 | 아키텍처 경계 100% 준수 |
| 미해결 차단요소 | ✅ 없음 | |

---

## 다음 단계

1. **Epic 3: 이동 시스템 시작** (`create-story` 워크플로우 사용)
2. **다음 스탠드업에서 액션 아이템 리뷰**
3. **E2E 테스트 프레임워크 도입** (Dana 담당)

---

## 기술적 성과 하이라이트

### 새로운 패턴/시스템

| 패턴 | 설명 | 파일 |
|------|------|------|
| Result<T> | 타입 안전 에러 처리 | game-core/src/state/types.ts |
| GameErrorCode | 에러 코드 union type | game-core/src/state/types.ts |
| PLAYER_COLORS | 플레이어별 색상 상수 | game-core/src/constants/player.ts |
| TROOP_COLORS | 병력 상태별 색상 | game-core/src/constants/troops.ts |
| TroopIndicator | Phaser 병력 표시 클래스 | game-renderer/src/rendering/TroopIndicator.ts |
| GeneralStatsPanel | React 스탯 패널 | apps/web/src/components/game/GeneralStatsPanel.tsx |
| gameUiStore | Zustand UI 상태 | apps/web/src/stores/gameUiStore.ts |

### 이벤트 시스템 확장

| 이벤트 | 페이로드 | 용도 |
|--------|----------|------|
| general:selected | { generalId } | 장수 선택 시 |
| general:deselected | { generalId \| null } | 장수 선택 해제 시 |
| general:troops-changed | { generalId, prev, current, max } | 병력 변화 시 (Epic 4) |

---

## 문서 정보

- **생성일:** 2026-02-04
- **다음 회고:** Epic 3 완료 후
- **Sprint Status 키:** epic-2-retrospective → done
