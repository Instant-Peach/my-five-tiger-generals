# Epic 4: 전투 시스템 (Combat System) 회고

## Epic 4 전체 요약

| 항목 | 결과 |
|------|------|
| 완료된 스토리 | 6/6 (100%) |
| 테스트 증가 | 352개 → 434개+ (82개+ 증가) |
| 차단 요소 | 0개 |

---

## 완료된 스토리 목록

| 스토리 | 제목 | 상태 |
|--------|------|------|
| 4-1 | 인접 타일 공격 가능 표시 | ✅ 완료 |
| 4-2 | 공격 방향 판정 | ✅ 완료 |
| 4-3 | 방향별 데미지 계산 | ✅ 완료 |
| 4-4 | 병력 감소 | ✅ 완료 |
| 4-5 | 장수 OUT 처리 | ✅ 완료 |
| 4-6 | 전투 피드백 | ✅ 완료 |

---

## What Went Well

### TDD 방식 일관 적용
- 모든 스토리에서 테스트 먼저 작성 후 구현
- 82개+ 테스트 추가로 전투 시스템 안정성 확보

### game-core Phaser 의존성 금지 100% 준수
- 전투 로직 전체가 순수 TypeScript로 구현
- game-renderer에서만 Phaser 사용

### Result<T> 패턴 일관 사용
- 모든 전투 관련 함수에서 성공/실패 명시적 반환
- 에러 처리 누락 방지

### 이벤트 세분화
- `combat:attack` - 공격 발생 시
- `troops:reduced` - 병력 감소 시
- `general:out` - 장수 OUT 시
- 각 이벤트별 독립적 처리 가능

### 애니메이션 시퀀싱 체계 확립
- 공격 이펙트 → 피격 이펙트 → 상태 업데이트 순서 정립
- Promise 기반 비동기 처리로 타이밍 제어

---

## What Could Be Improved

### E2E 테스트 프레임워크 아직 미도입
- 단위/통합 테스트는 충분하나 전체 플로우 테스트 부재
- Playwright 또는 Cypress 도입 검토 필요

### 사운드 에셋 placeholder 상태
- 공격/피격 사운드가 임시 파일
- 최종 에셋으로 교체 필요

### OUT 처리 시 하이라이트 미해제 (minor)
- 장수 OUT 시 선택 하이라이트가 남아있는 경우 있음
- 사용성에 큰 영향 없으나 개선 여지 있음

---

## Lessons Learned

### 방향 기반 전투 시스템 순서 중요성
```
방향 판정 → 데미지 계산 → 상태 변경
```
- 각 단계가 명확히 분리되어야 테스트/디버깅 용이
- 중간 단계 건너뛰기 금지

### 시각/청각 피드백의 중요성
- 데미지 숫자 표시, 화면 흔들림, 사운드 등
- 게임 몰입감과 직결되는 요소

### 디버그 함수로 테스트 가능성 향상
- `_setGeneralForTest()` 등 테스트 전용 함수
- 내부 상태 조작으로 다양한 시나리오 테스트 가능

---

## Action Items for Epic 5

| 항목 | 우선순위 | 담당 |
|------|----------|------|
| 타이머 UI 컴포넌트 설계 | 높음 | - |
| 턴 전환 로직 명세 | 높음 | - |
| E2E 테스트 도입 검토 | 중간 | - |

---

## 다음 단계

Epic 5: 턴 시스템 (Turn System) 진행 예정
- 5-1: 턴 타이머 UI
- 5-2: 턴 전환 로직
- 5-3: 행동 완료 처리
- 5-4: 턴 종료 조건
